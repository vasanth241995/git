  #- debug:
      #msg: "{{ hostvars['vwmazdsmdr01.fisdev.local']['service_list'] }}"
      
  #- set_fact: service_list="{{ (hostvars['vwmazdsmdr01.fisdev.local']['service_list']).split(',') }}"
  #- debug:
      #msg: "{{ item }}" 

  - name: Check service status
    win_service:
      name: "{{ item }}"
    register: service_status
  - debug:
      msg: "{{ service_status }}"
  - debug: 
      msg: "{{ item }} is {{ service_status['state'] }}"

  - name: Stop services
    win_service:
      name: "{{ item }}"
      state: stopped
    when: service_status['state'] == "running"
    
  - name: Start services
    win_service:
      name: "{{ item }}"
      state: started
    when: service_status['state'] == "running"

  - name: Check service status
    win_service:
      name: "{{ item }}"
    register: service_status_end
  - debug:
      msg: "{{ service_status_end }}"
  - debug: 
      msg: " {{ item }} is {{ service_status_end['state'] }} "
      
  - name: Show mesaage if restart fails
    debug:
      msg: Service failed to restart.
    when: service_status['state'] == "running" and service_status_end['state'] == "stopped"
  
    
